# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger: none
pool:
  vmImage: ubuntu-latest

steps:
  - task: replacetokens@4
    inputs:
      targetFiles: |
        kubernetes/app.yaml
      encoding: "auto"
      tokenPattern: "default"
      writeBOM: true
      actionOnMissing: "warn"
      keepToken: false
      actionOnNoFiles: "continue"
      enableTransforms: false
      useLegacyPattern: false
      enableTelemetry: true

  - task: Docker@2
    env:
      NODE_OPTIONS: --max_old_space_size=8192
    inputs:
      containerRegistry: "ACK"
      repository: "inc-appre-portalui"
      command: "buildAndPush"
      Dockerfile: "**/Dockerfile"
      buildContext: "$(Pipeline.Workspace)/s"

  - task: PublishPipelineArtifact@1
    inputs:
      targetPath: "$(Pipeline.Workspace)/s/kubernetes/app.yaml"
      artifact: "azure-deploy-ui"
      publishLocation: "pipeline"

  #- task: PublishPipelineArtifact@1
  #  inputs:
  #    targetPath: '$(Pipeline.Workspace)/s/manifest.yml'
  #     artifact: 'sap-deploy-azuredemo'
  #    publishLocation: 'pipeline'


